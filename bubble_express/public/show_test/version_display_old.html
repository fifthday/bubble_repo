<html>
<head>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
<link rel="stylesheet" href="css/screen.css" type="text/css" media="screen, projection">
<link rel="stylesheet" href="css/print.css" type="text/css" media="print">
<!--[if lt IE 8]><link rel="stylesheet" href="css/ie.css" type="text/css" media="screen, projection"><![endif]-->
<link rel="stylesheet" href="css/fancy-type/screen.css" type="text/css" media="screen, projection">
<style type="text/css">
div#comment_content {background-color:#AEEEEE;height:57%;width:45%;padding-right:20%;float:left;border:solid;}
div#comment_list {height:57%;width:15%;padding-right:10%;float:left;border:solid;}
div#rating_item {margin-left:35%;}

    
div.content_down
{
    	  width:80px;
    	  background-color:hsla(120,65%,75%,1);
        
       
}    
div.content_up
{
    	  width:80px;
    	  background-color:hsla(120,65%,75%,1);
        
       
}
div.content_left
{
    	  width:80px;
    	  background-color:hsla(120,65%,75%,1);
         
        
}
.clear{
        clear:both;
}
div.content_right
{
    	   
    	  width:80px;
    	  background-color:hsla(120,65%,75%,1);
         
       
}
div.dot_down
{
        height:0px;
        width:0px;
        border-width:10px 7px;
        border-style:solid dashed dashed dashed;
        border-color:hsla(120,65%,75%,1) transparent transparent transparent;
        overflow:hidden;
}
div.dot_left_down1
{
        height:0px;
        width:0px;
    	  border-style:solid dashed dashed solid;
    	  border-width:6px 20px;
        border-color:hsla(120,65%,75%,1) transparent transparent hsla(120,65%,75%,1);
        overflow:hidden;
}
div.dot_left_down2
{
        height:0px;
        width:0px;
        border-width:6px 12px;
    	  border-style:solid dashed dashed solid;
        border-color:#AEEEEE transparent transparent #AEEEEE;
        position:absolute;
        top:0px;
        overflow:hidden;
}
div.dot_left
{
        height:0px;
        width:0px;
    	  border-style:dashed solid dashed dashed;
    	  border-width:7px 25px 7px 25px;
        border-color:transparent hsla(120,65%,75%,1) transparent transparent;
        overflow:hidden;
        
}

div.dot_right
{
        height:0px;
        width:0px;
    	  border-style:dashed dashed dashed solid;
    	  border-width:7px 25px 7px 25px;
        border-color:transparent transparent transparent hsla(120,65%,75%,1);
        overflow:hidden;
        
}

div.dot_left_up1
{
        height:0px;
        width:0px;
        border-width:6px 20px;
    	  border-style:dashed dashed solid solid;
        border-color:transparent transparent hsla(120,65%,75%,1) hsla(120,65%,75%,1);
        overflow:hidden;
}
div.dot_left_up2
{
        height:0px;
        width:0px;
        border-width:6px 12px;
        border-style:dashed dashed solid solid;
        border-color:transparent transparent #AEEEEE #AEEEEE;
        overflow:hidden;
        top:0px;
        position:absolute;
}
div.dot_up
{
        height:0px;
        width:0px;
        border-width:10px 7px;
        border-style:dashed dashed solid dashed;
        border-color:transparent transparent hsla(120,65%,75%,1) transparent;
        overflow:hidden;
}
div.dot_right_up1
{
        height:0px;
        width:0px;
        border-width:6px 20px;
    	  border-style:dashed solid solid dashed;
        border-color:transparent hsla(120,65%,75%,1) hsla(120,65%,75%,1) transparent;
        overflow:hidden;
}
div.dot_right_up2
{
        height:0px;
        width:0px;
        border-width:6px 12px;
        border-style:dashed solid solid dashed;
        border-color:transparent #AEEEEE #AEEEEE transparent;
        overflow:hidden;
        top:0px;
        left:16px;
        position:absolute; 
} 

div.dot_right_down1
{
        height:0px;
        width:0px;
        border-width:6px 20px;
    	  border-style:solid solid dashed dashed;
        border-color:hsla(120,65%,75%,1) hsla(120,65%,75%,1) transparent transparent;
        overflow:hidden;
}
div.dot_right_down2
{
        height:0px;
        width:0px;
        border-width:6px 12px;
        border-style:solid solid dashed dashed;
        border-color:#AEEEEE #AEEEEE transparent transparent;
        overflow:hidden;
        top:0px;
        left:16px;
        position:absolute; 
} 

td {height:5%;}
</style>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/rating.min.js"></script>

<script defer type="text/javascript">
var is_focus = 1;
var is_glance = 0;
var is_comment = 0;
var offset_start_list = [1,6,11,16,23,30,145];
var offset_end_list = [2,7,12,17,24,31,146];
var spanLocation = new Array();
var is_locked = 0;
var totalSpanNum = 0;
var input_comment_num = 0;
//input 1：
var comments = ['comment 1	1','comment 2	1','comment 3	1','comment 4	5','comment 5	1','comment 6	1','comment 7	1','comment 8	1','comment 9	1','comment 10	7','comment 11	6','comment 12	1','comment 13	4','comment 14	5','comment 15lalalalalal	1','comment 16	5','comment 17	1','comment 18	1','comment 19	2','comment 20	7','comment 21	2','comment 22	2','comment 23	4','comment 24	7','comment 25	1','comment 26	1','comment 27	7','comment 28	7','comment 29	7','comment 30	1','comment 31	1','comment 32	5','comment 33	3','comment 34	2','comment 35	7','comment 36	1','comment 37	5','comment 38	1','comment 39	1','comment 40	1','comment 41	1','comment 42	1','comment 43	1','comment 44	2','comment 45	4','comment 46	7','comment 47	1','comment 48	1','comment 49	7','comment 50	1','comment 51	3'];
var is_choice = 0;
var slide_mode = 0;

function show_list(list_index){
	//  alert(list_index);
		var content = "";
		var content_detail = "";
		var comment = "";
		var caodian = "";
		var curSpanPos = "";
		var left_pos = 0;
		var top_pos = 0;
		if($("#new_page_glance").length>0)
		  $("#new_page_glance").remove();  
		if($("#list_show").length>0)
		  $("#list_show").remove();
		if($("#tempshow_part").length>0)
		  $("#tempshow_part").remove();
		content = comments[list_index];
		content_detail = content.split('\t');
		comment = content_detail[0];
		caodian = content_detail[1];  
		curSpanPos = $("#"+caodian).offset();
		left_pos = curSpanPos.left;
		top_pos = curSpanPos.top-15;//down arrow
		$("p").append("<div id=\"list_show\"></div>");
    $("#list_show").append("<div class=\"arrow\" id=\"list_show_arrow\"><div class=\"dot_down\"></div></div>");	
    $("#list_show_arrow").css({"position":"absolute","left":left_pos,"top":top_pos});  
		txt=$("<div id=\"list_show_content\" class=\"content_down\"></div>").text(comment);
		$("#list_show").append(txt);
    $("#list_show_content").css({"position":"absolute","left":left_pos-document.getElementById("list_show_content").offsetWidth/2,"top":top_pos-document.getElementById("list_show_content").offsetHeight});      

}

function showtable(){
 
  var tablename=document.getElementById("comment_table");
  var i = 0;
  //var li=tablename.getElementsByTagName("tr");
  var comment_index = 0;
  var content = "";
  var content_detail = "";
  var comment = "";
  var caodian = "";
  var line_num = 0;
  var comment_num = 0;
  if(comments.length<10)
    line_num = comments.length;
  else
  	line_num = 10;
  for (i=0;i<=line_num-1;i++){
  	comment_index = i + 1;
  	comment_num = i;
		$("#comment_table").append("<tr id=comment_content"+comment_index+" onmouseup=\"show_list("+comment_num+")\"></tr>");
		$("#comment_table").css({"width":"167\%"});
		content = comments[i];
		content_detail = content.split('\t');
		comment = content_detail[0];
		caodian = content_detail[1];
		$("#comment_content"+comment_index).append("<td>"+comment+"</td><td>"+caodian+"</td>");
	}
	for(i=line_num;i<=9;i++){
		comment_index = i + 1;
		$("#comment_table").append("<tr id=comment_content"+comment_index+"></tr>");
		$("#comment_table").css({"width":"167\%"});
		$("#comment_content"+comment_index).append("<td>--</td><td>--</td>");	  
	}
	
	var li=tablename.getElementsByTagName("tr");	
		//var li=tablename.getElementsByTagName("tr");
	for(i=0;i<=li.length-1;i++){	
    li[i].style.backgroundColor="yellow";
    li[i].onmouseover=function(){

    this.style.backgroundColor="#FFFFFF";
  
    }

    li[i].onmouseout=function(){

    this.style.backgroundColor="yellow"

    }

  }
  $("#comment_list").append("<button type=\"button\" disabled=true id=\"page_button\"}>上一页</button><button type=\"button\" onclick=\"pagedown(2)\" id=\"page_button\">下一页</button>")
}


function pagedown(page_num){
	
	 
  var tablename=document.getElementById("comment_table");
  var i = 0;
  //var li=tablename.getElementsByTagName("tr");
  var comment_index = 0;
  var content = "";
  var content_detail = "";
  var comment = "";
  var caodian = ""; 
  var line_num = 0;
  var comment_num = 0; 
  if(comments.length-(page_num-1)*10<10)
     line_num = comments.length-(page_num-1)*10;
  else
  	 line_num = 10;
  for (i=0;i<=9;i++){
  	comment_index = i + 1;
    if($("#comment_content"+comment_index).length>0)
      $("#comment_content"+comment_index).remove()
  }
  $("button").remove();
  
  for (i=0;i<=line_num-1;i++){
  	comment_index = i + 1;
  	comment_num = (page_num-1)*10+i;
		$("#comment_table").append("<tr id=comment_content"+comment_index+" onmouseup=\"show_list("+comment_num+")\"></tr>");
		$("#comment_table").css({"width":"167\%"});
		content = comments[(page_num-1)*10+i];
		content_detail = content.split('\t');
		comment = content_detail[0];
		caodian = content_detail[1];
		$("#comment_content"+comment_index).append("<td>"+comment+"</td><td>"+caodian+"</td>");
	}
	for(i=line_num;i<=9;i++){
		comment_index = i + 1;
		$("#comment_table").append("<tr id=comment_content"+comment_index+"></tr>");
		$("#comment_table").css({"width":"167\%"});
		$("#comment_content"+comment_index).append("<td>--</td><td>--</td>");	  
	}
	var li=tablename.getElementsByTagName("tr");	
		//var li=tablename.getElementsByTagName("tr");
	for(i=0;i<=li.length-1;i++){	
    li[i].style.backgroundColor="yellow";
    li[i].onmouseover=function(){

    this.style.backgroundColor="#FFFFFF";
  
    }

    li[i].onmouseout=function(){

    this.style.backgroundColor="yellow"

    }
  
  }
  if(page_num == 1){
    var next_page = page_num+1;
    $("#comment_list").append("<button type=\"button\" disabled=true>上一页</button><button type=\"button\" onclick=\"pagedown("+next_page+")\">下一页</button>")
    
  }
  else if(page_num>=2&&page_num<Math.ceil(comments.length/10)){
    var pre_page = page_num-1;
    var next_page = page_num+1;
    $("#comment_list").append("<button type=\"button\" onclick=\"pagedown("+pre_page+")\"}>上一页</button><button type=\"button\" onclick=\"pagedown("+next_page+")\">下一页</button>")
  }
  else if(page_num==Math.ceil(comments.length/10)){
    var pre_page = page_num-1;
 //   var next_page = page_num+1;
    $("#comment_list").append("<button type=\"button\" onclick=\"pagedown("+pre_page+")\"}>上一页</button><button type=\"button\" disabled=true>下一页</button>")
    
  }
}

function myfunction(commentListIndex,comment_idx,parent_index){
      var s="";
      var txt = "";
      var prefix = "apDiv";
      var loop_index = 0;
      var i = 0;
      var top_pos = "";
      var left_pos = "";
      var comment = "";
      var fco;
      var div_idx = 0;
      var prefix2 = "caodian";
  
      if(is_choice == 1){//清零
        return;
      }
      comment_idx = comment_idx + 1; 

      $("p").append("<div id=\"new_comment"+parent_index+"\"></div>");
      loop_index = 0;
      var x=$("#"+parent_index).offset();
      while(loop_index<=4){
      	s = "";
      	txt = "";
      	top_pos = 0;
      	left_pos = 0;
      	comment = "";
      	i = 0;
      	
  
        s = comments[commentListIndex];
        commentListIndex = commentListIndex + 1;

        var content_clean = s.split('\n')
        var content_list = s.split('\t')
        for (i = 0;i<content_list.length;i++){
          if(i == 0){
            comment = content_list[i];
          }
          else if(i == 1){
          	caodian_index = content_list[i]; 
          }
          
        }
        if(caodian_index!=parent_index){
        	if(commentListIndex >= comments.length){
                 	   
           
 	          top_pos = x.top+17;
	          left_pos = x.left;
	          $("#new_comment"+parent_index).append("<div id=\""+prefix2+parent_index+"apDiv8\"></div>");	
	          $("#"+prefix2+parent_index+"apDiv8").append("<div class=\"arrow\" id=\"arrow_"+prefix2+parent_index+"apDiv8\"><div class=\"dot_up\"></div></div>");
	          $("#arrow_"+prefix2+parent_index+"apDiv8").css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix2+parent_index+"apDiv8\" class=\"content_up\"></div>").text("单击查看更多吐槽");
	          $("#"+prefix2+parent_index+"apDiv8").append(txt);	
	          $("#content_"+prefix2+parent_index+"apDiv8").css({"position":"absolute","left":left_pos-document.getElementById("content_"+prefix2+parent_index+"apDiv8").offsetWidth/2,"top":top_pos+document.getElementById("arrow_"+prefix2+parent_index+"apDiv8").offsetHeight});      
 
            return;        	  
        	}
          continue;
        }      
        div_idx = div_idx+1;
	   
	      switch(loop_index)
	      {
	        case 0://arrow_right_down
	          top_pos = x.top-10;
	          left_pos = x.left-50;

	          $("#new_comment"+parent_index).append("<div id=\""+prefix2+parent_index+prefix+div_idx+"\"></div>");	
	          $("#"+prefix2+parent_index+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix2+parent_index+prefix+div_idx+"\"><div class=\"dot_right_down1\"></div><div class=\"dot_right_down2\"></div></div>");
	          $("#arrow_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix2+parent_index+prefix+div_idx+"\" class=\"content_down\"></div>").text(comment);
	          $("#"+prefix2+parent_index+prefix+div_idx).append(txt);	
	          $("#content_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos-document.getElementById("content_"+prefix2+parent_index+prefix+div_idx).offsetWidth/4*3,"top":top_pos-document.getElementById("content_"+prefix2+parent_index+prefix+div_idx).offsetHeight});      

	          
	          break;
	        case 1://arrow_down
	          top_pos = x.top-30;
	          left_pos = x.left;	     
	         
	          $("#new_comment"+parent_index).append("<div id=\""+prefix2+parent_index+prefix+div_idx+"\"></div>");	
	          $("#"+prefix2+parent_index+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix2+parent_index+prefix+div_idx+"\"><div class=\"dot_down\"></div></div>");
	          $("#arrow_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix2+parent_index+prefix+div_idx+"\" class=\"content_down\"></div>").text(comment);
	          $("#"+prefix2+parent_index+prefix+div_idx).append(txt);	
	          $("#content_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos-document.getElementById("content_"+prefix2+parent_index+prefix+div_idx).offsetWidth/2,"top":top_pos-document.getElementById("content_"+prefix2+parent_index+prefix+div_idx).offsetHeight});      
	                     
		            
	          break;
	        case 2://arrow_left_down
	          top_pos = x.top-10;
	          left_pos = x.left+20;	
	              
	          $("#new_comment"+parent_index).append("<div id=\""+prefix2+parent_index+prefix+div_idx+"\"></div>");	
	          $("#"+prefix2+parent_index+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix2+parent_index+prefix+div_idx+"\"><div class=\"dot_left_down1\"></div><div class=\"dot_left_down2\"></div></div>");
	          $("#arrow_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix2+parent_index+prefix+div_idx+"\" class=\"content_down\"></div>").text(comment);
	          $("#"+prefix2+parent_index+prefix+div_idx).append(txt);	
	          $("#content_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos+document.getElementById("content_"+prefix2+parent_index+prefix+div_idx).offsetWidth/4,"top":top_pos-document.getElementById("content_"+prefix2+parent_index+prefix+div_idx).offsetHeight});      
		              
	          break;
	       /* case 3://arrow_left -- ignore
	          top_pos = x.top;
	          left_pos = x.left+10;	 

	          $("#new_comment"+parent_index).append("<div id=\""+prefix2+parent_index+prefix+div_idx+"\"></div>");	
	          $("#"+prefix2+parent_index+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix2+parent_index+prefix+div_idx+"\"><div class=\"dot_left\"></div></div>");
	          $("#arrow_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix2+parent_index+prefix+div_idx+"\" class=\"content_left\"></div>").text(comment);
	          $("#"+prefix2+parent_index+prefix+div_idx).append(txt);	
	          $("#content_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","width":"80px","left":left_pos+document.getElementById("arrow_"+prefix2+parent_index+prefix+div_idx).offsetWidth,"top":top_pos-document.getElementById("arrow_"+prefix2+parent_index+prefix+div_idx).offsetHeight/4});      
					//	$("#"+prefix2+parent_index+prefix+div_idx).("<div class=\"clear\"></div>"); 
	                 
	          break;*/
	        case 3://arrow_left_up
	          top_pos = x.top+12;
	          left_pos = x.left+20;	      
	          
	          $("#new_comment"+parent_index).append("<div id=\""+prefix2+parent_index+prefix+div_idx+"\"></div>");	
	          $("#"+prefix2+parent_index+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix2+parent_index+prefix+div_idx+"\"><div class=\"dot_left_up1\"></div><div class=\"dot_left_up2\"></div></div>");
	          $("#arrow_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix2+parent_index+prefix+div_idx+"\" class=\"content_down\"></div>").text(comment);
	          $("#"+prefix2+parent_index+prefix+div_idx).append(txt);	
	          $("#content_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos+document.getElementById("content_"+prefix2+parent_index+prefix+div_idx).offsetWidth/4,"top":top_pos+document.getElementById("arrow_"+prefix2+parent_index+prefix+div_idx).offsetHeight});      
	          
	            
	          break;
	       /* case 5://arrow_right -- ignore
	          top_pos = x.top;
	          left_pos = x.left-30;	   
	          
	          $("#new_comment"+parent_index).append("<div id=\""+prefix2+parent_index+prefix+div_idx+"\"></div>");	
	          $("#"+prefix2+parent_index+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix2+parent_index+prefix+div_idx+"\"><div class=\"dot_right\"></div></div>");
	          $("#arrow_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix2+parent_index+prefix+div_idx+"\" class=\"content_right\"></div>").text(comment);
	          $("#"+prefix2+parent_index+prefix+div_idx).append(txt);	
	          $("#content_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos-document.getElementById("arrow_"+prefix2+parent_index+prefix+div_idx).offsetWidth-50,"top":top_pos-document.getElementById("arrow_"+prefix2+parent_index+prefix+div_idx).offsetHeight/4});      

	               
	          break;*/
	        case 4://arrow_right_up
	          top_pos = x.top+12;
	          left_pos = x.left-50;	     

	          $("#new_comment"+parent_index).append("<div id=\""+prefix2+parent_index+prefix+div_idx+"\"></div>");	
	          $("#"+prefix2+parent_index+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix2+parent_index+prefix+div_idx+"\"><div class=\"dot_right_up1\"></div><div class=\"dot_right_up2\"></div></div>");
	          $("#arrow_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix2+parent_index+prefix+div_idx+"\" class=\"content_up\"></div>").text(comment);
	          $("#"+prefix2+parent_index+prefix+div_idx).append(txt);	
	          $("#content_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos-document.getElementById("content_"+prefix2+parent_index+prefix+div_idx).offsetWidth/4*3,"top":top_pos+document.getElementById("arrow_"+prefix2+parent_index+prefix+div_idx).offsetHeight});      

	             
	          break;
	   
	        
	      }
	      loop_index = loop_index + 1;
	   //   $("#arrow_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	   
	    //  $("#"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos,"border":"thin solid rgb(238,232,170)","background-color":"hsla(120,65%,75%,1)"});        
        if(commentListIndex>=comments.length){ 
      //	  txt=$("<div id=\""+prefix2+parent_index+"apDiv8\"></div>").text("单击查看更多吐槽");
	    //    $("#new_comment"+parent_index).append(txt);    
	        top_pos = x.top+17;
	        left_pos = x.left;
	       
	        $("#new_comment"+parent_index).append("<div id=\""+prefix2+parent_index+"apDiv8\"></div>");	
	        $("#"+prefix2+parent_index+"apDiv8").append("<div class=\"arrow\" id=\"arrow_"+prefix2+parent_index+"apDiv8\"><div class=\"dot_up\"></div></div>");
	        $("#arrow_"+prefix2+parent_index+"apDiv8").css({"position":"absolute","left":left_pos,"top":top_pos});  
	        txt=$("<div id=\"content_"+prefix2+parent_index+"apDiv8\" class=\"content_up\"></div>").text("单击查看更多吐槽");
	        $("#"+prefix2+parent_index+"apDiv8").append(txt);	
	        $("#content_"+prefix2+parent_index+"apDiv8").css({"position":"absolute","left":left_pos-document.getElementById("content_"+prefix2+parent_index+"apDiv8").offsetWidth/2,"top":top_pos+document.getElementById("arrow_"+prefix2+parent_index+"apDiv8").offsetHeight});      

  
      
           return;
        }
      }
 	    top_pos = x.top+17;
	    left_pos = x.left;
	    $("#new_comment"+parent_index).append("<div id=\""+prefix2+parent_index+"apDiv8\"></div>");	
	    $("#"+prefix2+parent_index+"apDiv8").append("<div class=\"arrow\" id=\"arrow_"+prefix2+parent_index+"apDiv8\"><div class=\"dot_up\"></div></div>");
	    $("#arrow_"+prefix2+parent_index+"apDiv8").css({"position":"absolute","left":left_pos,"top":top_pos});  
	    txt=$("<div id=\"content_"+prefix2+parent_index+"apDiv8\" class=\"content_up\"></div>").text("单击查看更多吐槽");
	    $("#"+prefix2+parent_index+"apDiv8").append(txt);	
	    $("#content_"+prefix2+parent_index+"apDiv8").css({"position":"absolute","left":left_pos-document.getElementById("content_"+prefix2+parent_index+"apDiv8").offsetWidth/2,"top":top_pos+document.getElementById("arrow_"+prefix2+parent_index+"apDiv8").offsetHeight});      
} 	
	
function mainfunction(caodian_index){ //聚焦模式入口
	  
		  var ForReading = 1;
		 
		  var prefix = "apDiv";
		  var pre_time = 0;
		  var txt = "";
		  var comment_idx = 0;
		  var commentListIndex = 0;
		  
		  if(is_focus == 0)
		     return;
		  if($("#tempshow_part").length>0)
		     $("#tempshow_part").remove();   
		  if(is_locked==1)
		     return;
		  
	    myfunction(commentListIndex,comment_idx,caodian_index);
}


function mainoutfunction(caodian_index){
  if(is_focus == 0)
    return;
  if($("#tempshow_part").length>0)
		$("#tempshow_part").remove();    
  if(is_locked==1){
    return;
  }
	if($("#new_comment"+caodian_index).length>0)
	{
		 
		$("#new_comment"+caodian_index).remove();
	}
	
}

function proceedComment(commentListIndex,comment_idx,parent_index){
      var s="";
      var txt = "";
      var prefix = "apDiv";
      var prefix2 = "caodian";
      var loop_index = 0;
      var i = 0;
      var top_pos = "";
      var left_pos = "";
      var comment = "";
      var fco;
      var div_idx = 0;
      var caodian_index = 0;
      
      comment_idx = comment_idx + 1; 
    
      $("p").append("<div id=\"new_comment"+comment_idx+"\"></div>");
      loop_index = 0;
      while(loop_index<=5){
      	s = "";
      	txt = "";
      	top_pos = 0;
      	left_pos = 0;
      	comment = "";
      	i = 0;
      	
        div_idx = div_idx+1;
       
        s = comments[commentListIndex];
        commentListIndex = commentListIndex + 1;
        if(loop_index==7){
         
        }

        var content_clean = s.split('\n')
        var content_list = s.split('\t')
        for (i = 0;i<content_list.length;i++){
          if(i == 0){
            comment = content_list[i]
          }
          else if(i == 1){
          	caodian_index = content_list[i] 
          }
          
        }
        if(caodian_index!=parent_index){
        	if(commentListIndex >= comments.length){
            is_fadeout = 1;
            $("#new_comment"+comment_idx).fadeOut(6000,function(){is_locked = 0;if($("#new_comment"+comment_idx).length>0){$("#new_comment"+comment_idx).remove();}});
         	 
         
            return;        	  
        	}
          continue;
        }      
        var x=$("#"+caodian_index).offset();
  

        
	   
	      switch(loop_index)
	      {
	        case 0://arrow_right_down
	          top_pos = x.top-10;
	          left_pos = x.left-50;

	          $("#new_comment"+comment_idx).append("<div id=\""+prefix2+parent_index+prefix+div_idx+"\"></div>");	
	          $("#"+prefix2+parent_index+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix2+parent_index+prefix+div_idx+"\"><div class=\"dot_right_down1\"></div><div class=\"dot_right_down2\"></div></div>");
	          $("#arrow_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix2+parent_index+prefix+div_idx+"\" class=\"content_down\"></div>").text(comment);
	          $("#"+prefix2+parent_index+prefix+div_idx).append(txt);	
	          $("#content_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos-document.getElementById("content_"+prefix2+parent_index+prefix+div_idx).offsetWidth/4*3,"top":top_pos-document.getElementById("content_"+prefix2+parent_index+prefix+div_idx).offsetHeight});      

	          
	          break;
	        case 1://arrow_down
	          top_pos = x.top-30;
	          left_pos = x.left;	     
	         
	          $("#new_comment"+comment_idx).append("<div id=\""+prefix2+parent_index+prefix+div_idx+"\"></div>");	
	          $("#"+prefix2+parent_index+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix2+parent_index+prefix+div_idx+"\"><div class=\"dot_down\"></div></div>");
	          $("#arrow_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix2+parent_index+prefix+div_idx+"\" class=\"content_down\"></div>").text(comment);
	          $("#"+prefix2+parent_index+prefix+div_idx).append(txt);	
	          $("#content_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos-document.getElementById("content_"+prefix2+parent_index+prefix+div_idx).offsetWidth/2,"top":top_pos-document.getElementById("content_"+prefix2+parent_index+prefix+div_idx).offsetHeight});      
	                     
		            
	          break;
	        case 2://arrow_left_down
	          top_pos = x.top-10;
	          left_pos = x.left+20;	
	              
	          $("#new_comment"+comment_idx).append("<div id=\""+prefix2+parent_index+prefix+div_idx+"\"></div>");	
	          $("#"+prefix2+parent_index+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix2+parent_index+prefix+div_idx+"\"><div class=\"dot_left_down1\"></div><div class=\"dot_left_down2\"></div></div>");
	          $("#arrow_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix2+parent_index+prefix+div_idx+"\" class=\"content_down\"></div>").text(comment);
	          $("#"+prefix2+parent_index+prefix+div_idx).append(txt);	
	          $("#content_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos+document.getElementById("content_"+prefix2+parent_index+prefix+div_idx).offsetWidth/4,"top":top_pos-document.getElementById("content_"+prefix2+parent_index+prefix+div_idx).offsetHeight});      
		              
	          break;
	       /* case 3://arrow_left -- ignore
	          top_pos = x.top;
	          left_pos = x.left+10;	 

	          $("#new_comment"+parent_index).append("<div id=\""+prefix2+parent_index+prefix+div_idx+"\"></div>");	
	          $("#"+prefix2+parent_index+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix2+parent_index+prefix+div_idx+"\"><div class=\"dot_left\"></div></div>");
	          $("#arrow_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix2+parent_index+prefix+div_idx+"\" class=\"content_left\"></div>").text(comment);
	          $("#"+prefix2+parent_index+prefix+div_idx).append(txt);	
	          $("#content_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","width":"80px","left":left_pos+document.getElementById("arrow_"+prefix2+parent_index+prefix+div_idx).offsetWidth,"top":top_pos-document.getElementById("arrow_"+prefix2+parent_index+prefix+div_idx).offsetHeight/4});      
					//	$("#"+prefix2+parent_index+prefix+div_idx).("<div class=\"clear\"></div>"); 
	                 
	          break;*/
	        case 3://arrow_left_up
	          top_pos = x.top+12;
	          left_pos = x.left+20;	      
	          
	          $("#new_comment"+comment_idx).append("<div id=\""+prefix2+parent_index+prefix+div_idx+"\"></div>");	
	          $("#"+prefix2+parent_index+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix2+parent_index+prefix+div_idx+"\"><div class=\"dot_left_up1\"></div><div class=\"dot_left_up2\"></div></div>");
	          $("#arrow_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix2+parent_index+prefix+div_idx+"\" class=\"content_down\"></div>").text(comment);
	          $("#"+prefix2+parent_index+prefix+div_idx).append(txt);	
	          $("#content_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos+document.getElementById("content_"+prefix2+parent_index+prefix+div_idx).offsetWidth/4,"top":top_pos+document.getElementById("arrow_"+prefix2+parent_index+prefix+div_idx).offsetHeight});      
	          
	            
	          break;
	       /* case 5://arrow_right -- ignore
	          top_pos = x.top;
	          left_pos = x.left-30;	   
	          
	          $("#new_comment"+parent_index).append("<div id=\""+prefix2+parent_index+prefix+div_idx+"\"></div>");	
	          $("#"+prefix2+parent_index+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix2+parent_index+prefix+div_idx+"\"><div class=\"dot_right\"></div></div>");
	          $("#arrow_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix2+parent_index+prefix+div_idx+"\" class=\"content_right\"></div>").text(comment);
	          $("#"+prefix2+parent_index+prefix+div_idx).append(txt);	
	          $("#content_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos-document.getElementById("arrow_"+prefix2+parent_index+prefix+div_idx).offsetWidth-50,"top":top_pos-document.getElementById("arrow_"+prefix2+parent_index+prefix+div_idx).offsetHeight/4});      

	               
	          break;*/
	        case 4://arrow_right_up
	          top_pos = x.top+15;
	          left_pos = x.left;	     

	          $("#new_comment"+comment_idx).append("<div id=\""+prefix2+parent_index+prefix+div_idx+"\"></div>");	
	          $("#"+prefix2+parent_index+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix2+parent_index+prefix+div_idx+"\"><div class=\"dot_up\"></div></div>");
	          $("#arrow_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix2+parent_index+prefix+div_idx+"\" class=\"content_up\"></div>").text(comment);
	          $("#"+prefix2+parent_index+prefix+div_idx).append(txt);	
	          $("#content_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos-document.getElementById("content_"+prefix2+parent_index+prefix+div_idx).offsetWidth/2,"top":top_pos+document.getElementById("arrow_"+prefix2+parent_index+prefix+div_idx).offsetHeight});      

	             
	          break;
	        case 5://arrow_right_up
	          top_pos = x.top+12;
	          left_pos = x.left-50;	     

	          $("#new_comment"+comment_idx).append("<div id=\""+prefix2+parent_index+prefix+div_idx+"\"></div>");	
	          $("#"+prefix2+parent_index+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix2+parent_index+prefix+div_idx+"\"><div class=\"dot_right_up1\"></div><div class=\"dot_right_up2\"></div></div>");
	          $("#arrow_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix2+parent_index+prefix+div_idx+"\" class=\"content_up\"></div>").text(comment);
	          $("#"+prefix2+parent_index+prefix+div_idx).append(txt);	
	          $("#content_"+prefix2+parent_index+prefix+div_idx).css({"position":"absolute","left":left_pos-document.getElementById("content_"+prefix2+parent_index+prefix+div_idx).offsetWidth/4*3,"top":top_pos+document.getElementById("arrow_"+prefix2+parent_index+prefix+div_idx).offsetHeight});      

	             
	          break;	        
	        
	      }
	      loop_index = loop_index + 1;
	     
        if(commentListIndex>=comments.length){ 
       
         
         $("#new_comment"+comment_idx).fadeOut(6000,function(){is_locked = 0;if($("#new_comment"+comment_idx).length>0){$("#new_comment"+comment_idx).remove();}});
     
      
      
         return;
        }
      }
    
    
      $("#new_comment"+comment_idx).fadeOut(6000,function(){is_locked = 1; if($("#new_comment"+comment_idx).length>0){$("#new_comment"+comment_idx).remove();} proceedComment(commentListIndex,comment_idx,parent_index)});
} 

function showDetailComment(caodian_index){ //依次显示该槽点的吐槽，注意锁住
	var commentListIndex  = 0;
	var comment_index = 0;
	if(is_focus==0)
	   return;
	is_locked = 1;
	if($("#new_comment"+caodian_index).length>0)
	{
		 
		$("#new_comment"+caodian_index).remove();
	}
	proceedComment(commentListIndex,comment_index,caodian_index);	
}

function insertSpan(){
 var tweets = "《生活大爆炸》男星Jim Parsons将跟男友Todd Spiewak一同制作一部关于天才的新剧，该剧改编自youtube上一部讲述现实生活中天才的剧集《Prodigies》。Jim表示说：“我才看了一集就决定要把该剧以电视剧的形式推广向更多观众。跟这些天才这些神童打交道是一件很启发灵感、很快乐的事。”转";
 var new_tweets = "";
 var i = 0;
 var offset_index = 0;
 var spanId = 1;
 showtable(); 
 for(i=0;i<=tweets.length-1;i++){
          
    if(offset_index<=6 && i == offset_start_list[offset_index]){        
       new_tweets = new_tweets+"<span id="+spanId+" onmouseover=\"mainfunction("+spanId+")\" onmouseout=\"mainoutfunction("+spanId+")\" onmouseup=\"showDetailComment("+spanId+")\">";          
    }
    if(offset_index<=6 && i == offset_end_list[offset_index]){
       new_tweets = new_tweets+"</span>";
       offset_index = offset_index+1;
       spanId = spanId + 1;
    }
    new_tweets = new_tweets+tweets[i];
    
 }
 $("p").append(new_tweets+" ");
}

function show_glance(comment_global_index){ //浏览模式入口
      var s="";
      var txt = "";
      var prefix = "apDiv";
      var loop_index = 0;
      var i = 0;
      var top_pos = "";
      var left_pos = "";
      var comment = "";
      var fco;
      var div_idx = 0;
      var j = 0;
      var caodian_index = 0;
      var position = "";
      var left_pos = 0;
      var top_pos = 0; 
      var pos_queue = new Array();
      
      if(is_choice == 1){//清零
        return;
      }
      if($("#tempshow_part").length>0)
		     $("#tempshow_part").remove();  
      
      $("p").append("<div id=\"new_comment_glance\"></div>");
      //loop_index = 0;
      //var x=$("#"+parent_index).offset();
      var spanIndex = document.getElementsByTagName("span");
      for(k=0;k<=spanIndex.length;k++){
          pos_queue[k] = 0;
      } 
      for(i=0;i<=9;i++){
      	
        var content_list = comments[comment_global_index].split('\t')
        comment_global_index = comment_global_index + 1;
        if(comment_global_index>=comments.length){
            $("#new_comment_glance").fadeOut(3000,function(){if($("#new_comment_glance").length>0){$("#new_comment_glance").remove();}});
            comment_global_index = 0;
            return;
        }
        for (j = 0;j<content_list.length;j++){
          if(j == 0){
            comment = content_list[j]
          }
          else if(j == 1){
          	caodian_index = content_list[j] 
          	pos_queue[caodian_index]++;
          }
          
        }  
        position = $("#"+caodian_index).offset();
        div_idx = i;
        
        switch(pos_queue[parseInt(caodian_index)]){
	        case 3://left_up
	          top_pos = position.top-10;
	          left_pos = position.left-40;
            
	          $("#new_comment_glance").append("<div id=\"comment_glance_"+prefix+div_idx+"\"></div>");	
	          $("#comment_glance_"+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix+div_idx+"\"><div class=\"dot_right_down1\"></div><div class=\"dot_right_down2\"></div></div>");
	          $("#arrow_"+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix+div_idx+"\" class=\"content_down\"></div>").text(comment);
	          $("#comment_glance_"+prefix+div_idx).append(txt);	
	          $("#content_"+prefix+div_idx).css({"position":"absolute","left":left_pos-document.getElementById("content_"+prefix+div_idx).offsetWidth/4*3,"top":top_pos-document.getElementById("content_"+prefix+div_idx).offsetHeight});      
	          
	          break;
	        case 1://up
	          top_pos = position.top-20;
	          left_pos = position.left;	    

	          $("#new_comment_glance").append("<div id=\"comment_glance_"+prefix+div_idx+"\"></div>");	
	          $("#comment_glance_"+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix+div_idx+"\"><div class=\"dot_down\"></div></div>");
	          $("#arrow_"+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix+div_idx+"\" class=\"content_down\"></div>").text(comment);
	          $("#comment_glance_"+prefix+div_idx).append(txt);	
	          $("#content_"+prefix+div_idx).css({"position":"absolute","left":left_pos-document.getElementById("content_"+prefix+div_idx).offsetWidth/2,"top":top_pos-document.getElementById("content_"+prefix+div_idx).offsetHeight});      	          
	              
	          break;
	        case 4://right_up
	          top_pos = position.top-10;
	          left_pos = position.left+25;	        
	          
	          $("#new_comment_glance").append("<div id=\"comment_glance_"+prefix+div_idx+"\"></div>");	
	          $("#comment_glance_"+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix+div_idx+"\"><div class=\"dot_left_down1\"></div><div class=\"dot_left_down2\"></div></div>");
	          $("#arrow_"+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix+div_idx+"\" class=\"content_down\"></div>").text(comment);
	          $("#comment_glance_"+prefix+div_idx).append(txt);	
	          $("#content_"+prefix+div_idx).css({"position":"absolute","left":left_pos+document.getElementById("content_"+prefix+div_idx).offsetWidth/4,"top":top_pos-document.getElementById("content_"+prefix+div_idx).offsetHeight});      	          
	          
	          break;
	        case 7://right
	          top_pos = position.top;
	          left_pos = position.left-5;	  
	          
	          $("#new_comment_glance").append("<div id=\"comment_glance_"+prefix+div_idx+"\"></div>");	
	          $("#comment_glance_"+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix+div_idx+"\"><div class=\"dot_left\"></div></div>");
	          $("#arrow_"+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix+div_idx+"\" class=\"content_left\"></div>").text(comment);
	          $("#comment_glance_"+prefix+div_idx).append(txt);	
	          $("#content_"+prefix+div_idx).css({"position":"absolute","width":"80px","left":left_pos+document.getElementById("arrow_"+prefix+div_idx).offsetWidth,"top":top_pos-document.getElementById("arrow_"+prefix+div_idx).offsetHeight/4});      	          
	                
	          break;
	        case 5://right_down
	          top_pos = position.top+10;
	          left_pos = position.left+25;	        

	          $("#new_comment_glance").append("<div id=\"comment_glance_"+prefix+div_idx+"\"></div>");	
	          $("#comment_glance_"+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix+div_idx+"\"><div class=\"dot_left_up1\"></div><div class=\"dot_left_up2\"></div></div>");
	          $("#arrow_"+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix+div_idx+"\" class=\"content_down\"></div>").text(comment);
	          $("#comment_glance_"+prefix+div_idx).append(txt);	
	          $("#content_"+prefix+div_idx).css({"position":"absolute","left":left_pos+document.getElementById("content_"+prefix+div_idx).offsetWidth/4,"top":top_pos+document.getElementById("arrow_"+prefix+div_idx).offsetHeight});      	          
	          
	          break;
	        case 2://down
	          top_pos = position.top+5;
	          left_pos = position.left;	  
	           
	          $("#new_comment_glance").append("<div id=\"comment_glance_"+prefix+div_idx+"\"></div>");	
	          $("#comment_glance_"+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix+div_idx+"\"><div class=\"dot_up\"></div></div>");
	          $("#arrow_"+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix+div_idx+"\" class=\"content_up\"></div>").text(comment);
	          $("#comment_glance_"+prefix+div_idx).append(txt);	
	          $("#content_"+prefix+div_idx).css({"position":"absolute","left":left_pos-document.getElementById("content_"+prefix+div_idx).offsetWidth/2,"top":top_pos+document.getElementById("arrow_"+prefix+div_idx).offsetHeight});      	          
	                
	          break;
	        case 6://left_down
	          top_pos = position.top+10;
	          left_pos = position.left-40;	 
	          
	          $("#new_comment_glance").append("<div id=\"comment_glance_"+prefix+div_idx+"\"></div>");	
	          $("#comment_glance_"+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix+div_idx+"\"><div class=\"dot_right_up1\"></div><div class=\"dot_right_up2\"></div></div>");
	          $("#arrow_"+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix+div_idx+"\" class=\"content_up\"></div>").text(comment);
	          $("#comment_glance_"+prefix+div_idx).append(txt);	
	          $("#content_"+prefix+div_idx).css({"position":"absolute","left":left_pos-document.getElementById("content_"+prefix+div_idx).offsetWidth/4*3,"top":top_pos+document.getElementById("arrow_"+prefix+div_idx).offsetHeight});      
	          
	                 
	          break;
	        case 8://left
	          top_pos = position.top;
	          left_pos = position.left-25;	 
	          
	          $("#new_comment_glance").append("<div id=\"comment_glance_"+prefix+div_idx+"\"></div>");	
	          $("#comment_glance_"+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix+div_idx+"\"><div class=\"dot_right\"></div></div>");
	          $("#arrow_"+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix+div_idx+"\" class=\"content_right\"></div>").text(comment);
	          $("#comment_glance_"+prefix+div_idx).append(txt);	
	          $("#content_"+prefix+div_idx).css({"position":"absolute","width":"80px","left":left_pos-document.getElementById("content_"+prefix+div_idx).offsetWidth,"top":top_pos-document.getElementById("arrow_"+prefix+div_idx).offsetHeight/4});      	          
	                 
	          break;
        }
        
	    //  txt=$("<div id=\"glance_"+prefix+div_idx+"\"></div>").text(comment);
	    //  $("#new_comment_glance").append(txt);
 	    //  $("#glance_"+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos,"border":"thin solid rgb(238,232,170)","background-color":"hsla(120,65%,75%,1)"});        
             
      }
      $("#new_comment_glance").fadeOut(3000,function(){if($("#new_comment_glance").length>0){$("#new_comment_glance").remove();} show_glance(comment_global_index)});
	  
}

function show_page(page_num){
      var s="";
      var txt = "";
      var prefix = "apDiv";
      var loop_index = 0;
      var i = 0;
      var top_pos = "";
      var left_pos = "";
      var comment = "";
      var fco;
      var div_idx = 0;
      var j = 0;
      var caodian_index = 0;
      var position = "";
      var left_pos = 0;
      var top_pos = 0; 
      var comment_page_index = 0;
      var pos_queue = new Array();
      var k = 0;
      
      if(is_choice == 1){//清零
        return;
      }
      if($("#tempshow_part").length>0)
		     $("#tempshow_part").remove();  
      if($("#new_page_glance").length>0)
		     $("#new_page_glance").remove();       
      $("p").append("<div id=\"new_page_glance\"></div>");
      //loop_index = 0;
      //var x=$("#"+parent_index).offset();
      var spanIndex = document.getElementsByTagName("span");
      for(k=0;k<=spanIndex.length;k++){
          pos_queue[k] = 0;
      }     
      for(i=0;i<=9;i++){

      	comment_page_index = (page_num-1)*10+i;
      	if(comment_page_index>=comments.length)
      	  break;
        var content_list = comments[comment_page_index].split('\t')
        
         
        for (j = 0;j<content_list.length;j++){
          if(j == 0){
            comment = content_list[j];
          }
          else if(j == 1){
          	caodian_index = content_list[j];
          	pos_queue[parseInt(caodian_index)]++;
          	
          }
          
        }  
        position = $("#"+caodian_index).offset();
        div_idx = i;
        switch(pos_queue[parseInt(caodian_index)]){
	        case 3://left_up
	          top_pos = position.top-10;
	          left_pos = position.left-40;
            
	          $("#new_page_glance").append("<div id=\"page_glance_"+prefix+div_idx+"\"></div>");	
	          $("#page_glance_"+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix+div_idx+"\"><div class=\"dot_right_down1\"></div><div class=\"dot_right_down2\"></div></div>");
	          $("#arrow_"+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix+div_idx+"\" class=\"content_down\"></div>").text(comment);
	          $("#page_glance_"+prefix+div_idx).append(txt);	
	          $("#content_"+prefix+div_idx).css({"position":"absolute","left":left_pos-document.getElementById("content_"+prefix+div_idx).offsetWidth/4*3,"top":top_pos-document.getElementById("content_"+prefix+div_idx).offsetHeight});      
	          
	          break;
	        case 1://up
	          top_pos = position.top-20;
	          left_pos = position.left;	    

	          $("#new_page_glance").append("<div id=\"page_glance_"+prefix+div_idx+"\"></div>");	
	          $("#page_glance_"+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix+div_idx+"\"><div class=\"dot_down\"></div></div>");
	          $("#arrow_"+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix+div_idx+"\" class=\"content_down\"></div>").text(comment);
	          $("#page_glance_"+prefix+div_idx).append(txt);	
	          $("#content_"+prefix+div_idx).css({"position":"absolute","left":left_pos-document.getElementById("content_"+prefix+div_idx).offsetWidth/2,"top":top_pos-document.getElementById("content_"+prefix+div_idx).offsetHeight});      	          
	              
	          break;
	        case 4://right_up
	          top_pos = position.top-10;
	          left_pos = position.left+25;	        
	          
	          $("#new_page_glance").append("<div id=\"page_glance_"+prefix+div_idx+"\"></div>");	
	          $("#page_glance_"+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix+div_idx+"\"><div class=\"dot_left_down1\"></div><div class=\"dot_left_down2\"></div></div>");
	          $("#arrow_"+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix+div_idx+"\" class=\"content_down\"></div>").text(comment);
	          $("#page_glance_"+prefix+div_idx).append(txt);	
	          $("#content_"+prefix+div_idx).css({"position":"absolute","left":left_pos+document.getElementById("content_"+prefix+div_idx).offsetWidth/4,"top":top_pos-document.getElementById("content_"+prefix+div_idx).offsetHeight});      	          
	          
	          break;
	        case 7://right
	          top_pos = position.top;
	          left_pos = position.left-5;	  
	          
	          $("#new_page_glance").append("<div id=\"page_glance_"+prefix+div_idx+"\"></div>");	
	          $("#page_glance_"+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix+div_idx+"\"><div class=\"dot_left\"></div></div>");
	          $("#arrow_"+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix+div_idx+"\" class=\"content_left\"></div>").text(comment);
	          $("#page_glance_"+prefix+div_idx).append(txt);	
	          $("#content_"+prefix+div_idx).css({"position":"absolute","width":"80px","left":left_pos+document.getElementById("arrow_"+prefix+div_idx).offsetWidth,"top":top_pos-document.getElementById("arrow_"+prefix+div_idx).offsetHeight/4});      	          
	                
	          break;
	        case 5://right_down
	          top_pos = position.top+10;
	          left_pos = position.left+25;	        

	          $("#new_page_glance").append("<div id=\"page_glance_"+prefix+div_idx+"\"></div>");	
	          $("#page_glance_"+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix+div_idx+"\"><div class=\"dot_left_up1\"></div><div class=\"dot_left_up2\"></div></div>");
	          $("#arrow_"+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix+div_idx+"\" class=\"content_down\"></div>").text(comment);
	          $("#page_glance_"+prefix+div_idx).append(txt);	
	          $("#content_"+prefix+div_idx).css({"position":"absolute","left":left_pos+document.getElementById("content_"+prefix+div_idx).offsetWidth/4,"top":top_pos+document.getElementById("arrow_"+prefix+div_idx).offsetHeight});      	          
	          
	          break;
	        case 2://down
	          top_pos = position.top+5;
	          left_pos = position.left;	  
	           
	          $("#new_page_glance").append("<div id=\"page_glance_"+prefix+div_idx+"\"></div>");	
	          $("#page_glance_"+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix+div_idx+"\"><div class=\"dot_up\"></div></div>");
	          $("#arrow_"+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix+div_idx+"\" class=\"content_up\"></div>").text(comment);
	          $("#page_glance_"+prefix+div_idx).append(txt);	
	          $("#content_"+prefix+div_idx).css({"position":"absolute","left":left_pos-document.getElementById("content_"+prefix+div_idx).offsetWidth/2,"top":top_pos+document.getElementById("arrow_"+prefix+div_idx).offsetHeight});      	          
	                
	          break;
	        case 6://left_down
	          top_pos = position.top+10;
	          left_pos = position.left-40;	 
	          
	          $("#new_page_glance").append("<div id=\"page_glance_"+prefix+div_idx+"\"></div>");	
	          $("#page_glance_"+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix+div_idx+"\"><div class=\"dot_right_up1\"></div><div class=\"dot_right_up2\"></div></div>");
	          $("#arrow_"+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix+div_idx+"\" class=\"content_up\"></div>").text(comment);
	          $("#page_glance_"+prefix+div_idx).append(txt);	
	          $("#content_"+prefix+div_idx).css({"position":"absolute","left":left_pos-document.getElementById("content_"+prefix+div_idx).offsetWidth/4*3,"top":top_pos+document.getElementById("arrow_"+prefix+div_idx).offsetHeight});      
	          
	                 
	          break;
	        case 8://left
	          top_pos = position.top;
	          left_pos = position.left-25;	 
	          
	          $("#new_page_glance").append("<div id=\"page_glance_"+prefix+div_idx+"\"></div>");	
	          $("#page_glance_"+prefix+div_idx).append("<div class=\"arrow\" id=\"arrow_"+prefix+div_idx+"\"><div class=\"dot_right\"></div></div>");
	          $("#arrow_"+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos});  
	          txt=$("<div id=\"content_"+prefix+div_idx+"\" class=\"content_right\"></div>").text(comment);
	          $("#page_glance_"+prefix+div_idx).append(txt);	
	          $("#content_"+prefix+div_idx).css({"position":"absolute","width":"80px","left":left_pos-document.getElementById("content_"+prefix+div_idx).offsetWidth,"top":top_pos-document.getElementById("arrow_"+prefix+div_idx).offsetHeight/4});      	          
	                 
	          break;
        }
         
	    //  txt=$("<div id=\"page_glance_"+prefix+div_idx+"\"></div>").text(comment);
	    //  $("#new_page_glance").append(txt);
 	    //  $("#page_glance_"+prefix+div_idx).css({"position":"absolute","left":left_pos,"top":top_pos,"border":"thin solid rgb(238,232,170)","background-color":"hsla(120,65%,75%,1)"});        
             
      }
      
}


function getSelectedText() {
	var i = 0;
	var is_span = 0;
	var content = "";
	var j = 0;
	var curStart = 0;
	var curEnd = 0;
	var preIndex = 0;
	var curId = 0;
	var test_position = "";
	var check_position = "";
	var new_span_id = totalSpanNum + 1; 
	var is_choose_tag = 0;
	var curSpanPos = "";
	if (window.getSelection) {
			var selection_range = window.getSelection();
			var range = selection_range.getRangeAt(0);
		  
 		 //有两种可能，一种是选在文字上了，一种是选在标签上了，注意区分
		  if(range.startContainer.length > range.startOffset){
		 		 range.setEnd(range.startContainer,range.startOffset+1);
		 	   is_choose_tag = 0;
		 	}
		 	else{//选中标签了，可以不处理，但要知道是选中哪个标签了
		 		 is_choose_tag = 1;
		 		 var dt = document.createElement("span");
		 		 dt.id = new_span_id;
		 
		     range.insertNode(dt);
		     $("#"+new_span_id).text(" ");
		 		 
		 		 test_position = $("#"+new_span_id).offset();
		 		 $("#"+new_span_id).remove();
		 	 
		 		 var oriSpanIndex = document.getElementsByTagName("span"); 
		 		 for(j = 0;j<=oriSpanIndex.length-1;j++){
			 
			    check_position = $("#"+oriSpanIndex[j].id).offset(); 
			  	if(test_position.left == check_position.left && test_position.top == check_position.top && oriSpanIndex[j].id != dt.id){
		  	  
		  	  	curId = oriSpanIndex[j].id;
		  	  	curStart = offset_start_list[oriSpanIndex[j].id-1];
		  	  	curEnd = offset_end_list[oriSpanIndex[j].id-1];
		  	//  	alert("wdwd"+curStart);
		  	  	curSpanPos = $("#"+oriSpanIndex[j].id).offset();
		  	 
		    	}		 		   
		 		 }
		 		 //单独处理
		 		 
		  }
		  if(is_choose_tag == 0){
		  	var dt = document.createElement("span");
		    var frag = range.extractContents();
		 
		    dt.appendChild(frag);
			  range.insertNode(dt);
	 
		  	dt.id=new_span_id;
			  dt.setAttribute("onmouseup", "showDetailComment("+new_span_id+")"); 
		    dt.setAttribute("onmouseout", "mainoutfunction("+new_span_id+")");
		    dt.setAttribute("onmouseover", "mainfunction("+new_span_id+")");
			  curSpanPos = $("#"+new_span_id).offset();
		  
			  var spanIndex = document.getElementsByTagName("span");
			  for(j = 0;j<=spanIndex.length-1;j++){
				  if(spanIndex[j].id == dt.id){
		 
					  break;
				  }
			  }
			  if(j>0){
			    preIndex = spanIndex[j-1].id;
			    curStart = offset_end_list[preIndex-1]+range.startOffset;
			    curEnd = offset_end_list[preIndex-1]+range.startOffset;
		      
			  }
			  else{
			    curStart = range.startOffset;
			    curEnd = range.startOffset;//curStart,curEnd是字偏移
			 
			  }
		//    alert("wd"+curStart);
		   if(j==0){ //比较后一个span的坐标
			  test_position = $("#"+dt.id).offset();
			  check_position = $("#"+spanIndex[j+1].id).offset();
			  if(test_position.left == check_position.left && test_position.top == check_position.top){
		  	
		  	  curId = spanIndex[j+1].id;
		  	  curStart = offset_start_list[spanIndex[j+1].id-1];
		  	  var remove_txt = $("#"+spanIndex[j+1].id).text();
		  	  //alert(remove_txt);
		  	  $("#"+new_span_id).remove();
		  	  $("#"+curId).text(remove_txt);
		  	
		    }
		    else{
			    offset_start_list[totalSpanNum] = curStart;
			    offset_end_list[totalSpanNum] = curStart+1;
			    curId = new_span_id;    
			    totalSpanNum = totalSpanNum + 1;		    
		    }
		   }
		   else if(j>0 && j<spanIndex.length-1){//比较前后两个span的坐标
			  test_position = $("#"+dt.id).offset();
			  check_position = $("#"+spanIndex[j-1].id).offset();
			  if(test_position.left == check_position.left && test_position.top == check_position.top){
		  	
		  	  curId = spanIndex[j-1].id;
		  	  curStart = offset_start_list[spanIndex[j-1].id-1];
		  	  var remove_txt = $("#"+spanIndex[j-1].id).text();
		  	 // alert(remove_txt);
		  	  $("#"+new_span_id).remove();
		  	  $("#"+curId).text(remove_txt);
		    }
		    else{
		  	  check_position = $("#"+spanIndex[j+1].id).offset();
			    if(test_position.left == check_position.left && test_position.top == check_position.top){
		  	  
		  	    curId = spanIndex[j+1].id;
		  	    curStart = offset_start_list[spanIndex[j+1].id-1];
		  	    var remove_txt = $("#"+spanIndex[j+1].id).text();
		  	   // alert(remove_txt);
		  	    $("#"+new_span_id).remove();
		  	    $("#"+curId).text(remove_txt);
		      }
		      else{
			      offset_start_list[totalSpanNum] = curStart;
			      offset_end_list[totalSpanNum] = curStart+1;
			      curId = new_span_id;    
			      totalSpanNum = totalSpanNum + 1;		    
		      }
		    }	
		
		
		   }
		   else if(j==spanIndex.length-1){//比较前一个span坐标
			  test_position = $("#"+dt.id).offset();
		  	check_position = $("#"+spanIndex[j-1].id).offset();
			  if(test_position.left == check_position.left && test_position.top == check_position.top){
		  	  
		  	  curId = spanIndex[j-1].id;
		  	  curStart = offset_start_list[spanIndex[j-1].id-1];
		  	  var remove_txt = $("#"+spanIndex[j-1].id).text();
		  	   
		  	  $("#"+new_span_id).remove();
		  	  $("#"+curId).text(remove_txt);
		    }
		    else{
			    offset_start_list[totalSpanNum] = curStart;
			    offset_end_list[totalSpanNum] = curStart+1;
			    curId = new_span_id;    
			    totalSpanNum = totalSpanNum + 1;		    
		    }		
		
		   }
		  }
	  $("body").append("<div id=\"inputComment\">enter your comment:<input type=\"text\" id=\"user_comment\" style=\"border:0\"/><input type=\"button\" value = \"OK\" onclick=\"getComment("+curStart+","+curId+","+curSpanPos.left+","+curSpanPos.top+")\" /></div>");				
	  $("#inputComment").css({"position":"absolute","width": "180px","height":"45px","left":curSpanPos.left,"top":curSpanPos.top-80,"border":0,"background":"url('image/hover.png')"});        
		
		
	}
	else if (document.getSelection) {
			alert("document.getSelection");
	  
	}
	else if (document.selection) {
		  alert("document.selection");

	}
}

function getSpanPosition(){
  var SpanIndex = 0;
  var i = 0;
  totalSpanNum = 0;
  while(1){
  	SpanIndex = SpanIndex + 1;
  	if($("#"+SpanIndex).length == 0)
      break;
    else{
    	
    	var val = $("#"+SpanIndex).offset();
     
      totalSpanNum = totalSpanNum + 1;
    }  
  }
   
}


function enterComment() { //评论模式入口
	if(is_comment == 0)
	  return;
	getSelectedText();
	 
}

function getComment(curStart,curId,left_pos,top_pos){
	input_comment_num = input_comment_num + 1;
  var content=document.getElementById("user_comment").value;
  if(content==""||content==" "){
    alert("评论内容不能为空！");
    return;
  }  
//  alert(curStart); 
	$("#inputComment").remove();
	if($("#tempshow_part").length==0)
	  $("p").append("<div id=\"tempshow_part\"></div>");
//	var txt=$("<div id=\"tempshow_"+input_comment_num+"\"></div>").text(content);
//	$("#tempshow_part").append(txt);
// 	$("#tempshow_"+input_comment_num).css({"position":"absolute","left":left_pos,"top":top_pos-40,"border":"thin solid rgb(238,232,170)","background-color":"hsla(120,65%,75%,1)"});        

	$("#tempshow_part").append("<div id=\"tempshow_item_"+input_comment_num+"\"></div>");	
	$("#tempshow_item_"+input_comment_num).append("<div class=\"arrow\" id=\"tempshow_arrow_"+input_comment_num+"\"><div class=\"dot_down\"></div></div>");
	$("#tempshow_arrow_"+input_comment_num).css({"position":"absolute","left":left_pos,"top":top_pos-25});  
	var txt=$("<div id=\"tempshow_content_"+input_comment_num+"\" class=\"content_down\"></div>").text(content);
	$("#tempshow_item_"+input_comment_num).append(txt);	
	$("#tempshow_content_"+input_comment_num).css({"position":"absolute","left":left_pos-document.getElementById("tempshow_content_"+input_comment_num).offsetWidth/2,"top":top_pos-25-document.getElementById("tempshow_content_"+input_comment_num).offsetHeight});      	          
  //input2：uid,tid,date,type:word,words:content,start:curStart,end:curStart+1,
//comments[comments.length] = content+"\t"+curId;
	comments.unshift(content+"\t"+curId);
	pagedown(1);
}

function choice_mode(choice_value){
	if($("#list_show").length>0)
		 $("#list_show").remove();
  if($("#new_page_glance").length>0)
		 $("#new_page_glance").remove();  
//	is_choice = 1;
  switch(choice_value){
    case 1://聚焦模式
      is_focus = 1;
      is_glance = 0;
      is_comment = 0;
      slide_mode = 0;
      if($("#tempshow_part").length>0)
		     $("#tempshow_part").remove();  
      break;
    case 2://浏览模式
      is_focus = 0;
      is_glance = 1;
      is_comment = 0;
      slide_mode = 0;
      show_glance(0);
      break;
    case 3://评论模式
      is_focus = 0;
      is_glance = 0;
      slide_mode = 0;
      is_comment = 1;
      getSpanPosition();
      break;
    case 4://进度条模式
      is_focus = 0;
      is_glance = 0;
      is_comment = 0;
      slide_mode = 1;
      show_page(1);
      break;
    case 5:
      is_focus = 0;
      break;
    case 6:
      is_glance = 0;
      break;
    case 7:
      is_comment = 0;
      break;
    case 8:
      slide_mode = 0;
      break;
  }
}

function changebackground(list_index){
	 
  $("#comment_item"+list_index).css({"background-color":"yellow"});
}

function show_comment_item(list_index){
}

</script>

<script type="text/javascript">
      $(document).ready(function () {
         $('#rating-21').slidy({
            maxval: Math.ceil(comments.length/10)  ,
            interval: 1,
            defaultValue: 1,
            finishedCallback: function (value) {
            	if(slide_mode == 1){
            	  pagedown(value);
                show_page(value);
              }
         }
      });
 
    })
</script>

</head>

<body onload ="insertSpan()">
<div id="comment_content">	
<input type="radio" name="choice" value = "focus" checked=true onclick ="this.checked==true?choice_mode(1):choice_mode(5);">聚焦模式</input>
<input type="radio" name="choice" value = "glance" onclick ="this.checked==true?choice_mode(2):choice_mode(6);">浏览模式</input>
<input type="radio" name="choice" value = "comment" onclick ="this.checked==true?choice_mode(3):choice_mode(7);">评论模式</input>
<input type="radio" name="choice" value = "slide" onclick ="this.checked==true?choice_mode(4):choice_mode(8);">进度条模式</input>

</br>
<h>Tweet is:</h>
<div id="new_input_comment" onmouseup = "enterComment()">
<p style="padding-left: 10%"></p>

</div>
<div id="rating_item" class="example">
   <div id="rating-21"></div>
   <div id="result-21"></div>
   <div class="clearfix"></div>
</div>
</div>
<div id="comment_list">
<h>吐槽列表</h>
<table id="comment_table"></table>
</div>




</body>

</html>
